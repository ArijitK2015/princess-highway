<?xml version="1.0"?>
<config>
	
	<modules>
        <FactoryX_CampaignMonitor>
            <version>0.7.3</version>
        </FactoryX_CampaignMonitor>
    </modules>
    
	<frontend>
		<!-- Translation file -->
		<translate>
            <modules>
                <FactoryX_CampaignMonitor>
                    <files>
                        <default>FactoryX_CampaignMonitor.csv</default>
                    </files>
                </FactoryX_CampaignMonitor>
            </modules>
        </translate>
		<routers>
			<!-- Declare frontend name -->
			<factoryx_campaignmonitor>
				<use>standard</use>
				<args>
                    <module>FactoryX_CampaignMonitor</module>
                    <frontName>campaignmonitor</frontName>
				</args>
            </factoryx_campaignmonitor>
			<!-- Override original newsletter controllers -->
			<newsletter>
				<args>
					<modules>
						<factoryx_campaignmonitor before="Mage_Newsletter_ManageController">FactoryX_CampaignMonitor_ManageController</factoryx_campaignmonitor>
						<factoryx_campaignmonitor before="Mage_Newsletter_SubscriberController">FactoryX_CampaignMonitor_SubscriberController</factoryx_campaignmonitor>
					</modules>
				</args>
			</newsletter>
        </routers>
		<!-- Frontend layout file -->
		<layout>
            <updates>
                <campaignmonitor>
                    <file>factoryx/campaignmonitor.xml</file>
                </campaignmonitor>
            </updates>
        </layout>
    </frontend>
	
	<adminhtml>
		<!-- Backend translation file -->
        <translate>
            <modules>
                <FactoryX_CampaignMonitor>
                    <files>
                        <default>FactoryX_CampaignMonitor.csv</default>
                    </files>
                </FactoryX_CampaignMonitor>
            </modules>
        </translate>
    </adminhtml>
    
	<global>
	
		<blocks>
			<!-- Declare module blocks -->
			<campaignmonitor>
				<class>FactoryX_CampaignMonitor_Block</class>
			</campaignmonitor>
			<!-- Override original adminhtml newsletter block -->
			<adminhtml>
				<rewrite>
					<newsletter_subscriber_grid>FactoryX_CampaignMonitor_Block_Adminhtml_Newsletter_Subscriber_Grid</newsletter_subscriber_grid>
				</rewrite>
			</adminhtml>
		</blocks>
	
		<!-- NOT IN USE: Rewrite the save action of the frontend newsletter management page -->
		<rewrite>
			<factoryx_campaignmonitor_manage_save>
				<from><![CDATA[#^/newsletter/manage/save#]]></from>
				<to>campaignmonitor/manage/save</to>
			</factoryx_campaignmonitor_manage_save>
		</rewrite>
		
		<models>
			<!-- Declare module models -->
			<campaignmonitor>
				<class>FactoryX_CampaignMonitor_Model</class>
			</campaignmonitor>
			<!-- Override original newsletter subscriber model -->
			<newsletter>
				<rewrite>
					<subscriber>FactoryX_CampaignMonitor_Model_Subscriber</subscriber>
				</rewrite>
			</newsletter>
			<!-- Override original checkout onepage model -->
			<checkout>
        		<rewrite>
					<!-- Mage_Checkout_Model_Type_Onepage -->
        			<type_onepage>FactoryX_CampaignMonitor_Model_Checkout_Type_Onepage</type_onepage>
        		</rewrite>
        	</checkout>
		</models>
		
		<!-- Observer events -->
		<events>
			<customer_save_before>
				<observers>
					<factoryx_campaignmonitor_observer>
						<type>singleton</type>
						<class>campaignmonitor/customer_observer</class>
						<method>check_subscription_status</method>
					</factoryx_campaignmonitor_observer>
				</observers>
			</customer_save_before>     
			<customer_delete_before>
				<observers>
					<factoryx_campaignmonitor_observer_2>
						<type>singleton</type>
						<class>campaignmonitor/customer_observer</class>
						<method>customer_deleted</method>
					</factoryx_campaignmonitor_observer_2>
				</observers>
			</customer_delete_before>
			<checkout_type_onepage_save_order_after>
                <observers>
                    <subscribeCustomer>
                        <type>singleton</type>
                        <class>campaignmonitor/checkout_observer</class>
                        <method>subscribeCustomer</method>
                    </subscribeCustomer>
                </observers>
            </checkout_type_onepage_save_order_after>			
		</events>
		
		<routers>
			<newsletter>
				<rewrite>
					<!-- Reroute the subscriber controller actions -->
					<subscriber>
						<to>campaignmonitor/subscriber</to>
						<override_actions>true</override_actions>
					</subscriber>
					<!-- Reroute the manage controller actions -->
					<manage>
						<to>campaignmonitor/manage</to>
						<override_actions>true</override_actions>
					</manage>
				</rewrite>
			</newsletter>
		</routers>
		
		<!-- Database access resources -->
		<resources>       
			<campaignmonitor_setup>
				<setup>
					<module>FactoryX_CampaignMonitor</module>
				</setup>
				<connection>
					<use>core_setup</use>
				</connection>
			</campaignmonitor_setup>
			<campaignmonitor_write>
				<connection>
					<use>core_write</use>
				</connection>
			</campaignmonitor_write>
			<campaignmonitor_read>
				<connection>
					<use>core_read</use>
				</connection>
			</campaignmonitor_read>
		</resources>
		
		<helpers>
			<!-- Declare module helper -->
            <campaignmonitor>
                <class>FactoryX_CampaignMonitor_Helper</class>
            </campaignmonitor>
        </helpers>
		
    </global>
	
	<default>
		<!-- Default Backend Values -->
    	<newsletter>
			<coupon>
				<enable>0</enable>
                <prefix>newsletter</prefix>
                <spend>100</spend>
                <value>10</value>
                <offer>cart_fixed</offer>
                <valid>30</valid>
			</coupon>
    		<checkoutnewsletter>
    			<enable>1</enable>
    			<checked>1</checked>
    			<visible_guest>1</visible_guest>
    			<visible_register>1</visible_register>
    		</checkoutnewsletter>
    	</newsletter>
    </default>
	
</config>
